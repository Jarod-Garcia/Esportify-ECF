<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Joueur - ESPORTIFY</title>
    <link rel="icon" type="image/png" href="../assets/images/esportify-icon.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/dashboard-unified.css">
    <link rel="stylesheet" href="../css/messages.css">
</head>
<body>
    
    <nav>
        <div class="nav-container">
            <div class="logo-wrapper">
                <div class="logo">ESPORTIFY</div>
                <div class="tagline">Dashboard Joueur</div>
            </div>
            <ul class="nav-links">
                <li><a href="../index.html">Accueil</a></li>
                <li><a href="events.html">√âv√©nements</a></li>
                <li><a href="#" class="user-badge-nav">
                    <span class="user-avatar-small">PG</span>
                    <span>ProGamer123</span>
                </a></li>
                <li><a href="#" onclick="logoutUser()" class="logout-link">D√©connexion</a></li>
            </ul>
        </div>
    </nav>

    <section class="hero hero-dashboard">
        <div class="hero-content">
            <h1>BIENVENUE</h1>
            <p>Tableau de bord joueur</p>
        </div>
    </section>

    <section class="dashboard-nav-section">
        <div class="content-container">
            <div class="dashboard-tabs">
                <button class="tab-btn active" data-section="overview">
                    <span class="tab-icon">üìä</span>
                    <span>Vue d'ensemble</span>
                </button>
                <button class="tab-btn" data-section="my-events">
                    <span class="tab-icon">üéÆ</span>
                    <span>Mes √©v√©nements</span>
                </button>
                <button class="tab-btn" data-section="favorites">
                    <span class="tab-icon">‚≠ê</span>
                    <span>Favoris</span>
                </button>
                <button class="tab-btn" data-section="scores">
                    <span class="tab-icon">üèÜ</span>
                    <span>Scores</span>
                </button>
                <button class="tab-btn" data-section="profile">
                    <span class="tab-icon">üë§</span>
                    <span>Profil</span>
                </button>
                <button class="tab-btn" data-section="chat">
                    <span class="tab-icon">üí¨</span>
                    <span>Chat √âv√©nement</span>
                </button>
            </div>
        </div>
    </section>

    <section id="overview" class="dashboard-section active">
        
        <div class="stats-section">
            <div class="content-container">
                <h2 class="section-title">Vos Statistiques</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üéÆ</div>
                        <div class="stat-details">
                            <div class="stat-label">√âv√©nements rejoints</div>
                            <div class="stat-value">12</div>
                            <div class="stat-change">+3 ce mois</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-details">
                            <div class="stat-label">Victoires</div>
                            <div class="stat-value">7</div>
                            <div class="stat-change">58% win rate</div>
                        </div>
                    </div>

                    <div class="stat-card warning">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-details">
                            <div class="stat-label">En attente</div>
                            <div class="stat-value">2</div>
                            <div class="stat-change">Validation organisateur</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="events-section">
            <div class="content-container">
                <h2 class="section-title">√âv√©nements √† Venir</h2>
                <div class="events-grid">
                    <div class="event-card">
                        <div class="event-header">
                            <span class="event-badge upcoming">√Ä VENIR</span>
                            <span class="event-date">25 Nov 2025</span>
                        </div>
                        <div class="event-icon-large">üéÆ</div>
                        <h3 class="event-title">Tournoi League of Legends</h3>
                        <div class="event-meta">
                            <div class="meta-item">
                                <span class="meta-icon">üë§</span>
                                <span>Organisateur: ProGaming</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-icon">üë•</span>
                                <span>Joueurs: 12/16</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-icon">üïê</span>
                                <span>18:00</span>
                            </div>
                        </div>
                        <div class="event-actions">
                            <button class="btn-primary">Voir d√©tails</button>
                            <button class="btn-secondary">Se d√©sinscrire</button>
                        </div>
                    </div>

                    <div class="event-card">
                        <div class="event-header">
                            <span class="event-badge live">EN COURS</span>
                            <span class="event-date">20 Nov 2025</span>
                        </div>
                        <div class="event-icon-large">üöÄ</div>
                        <h3 class="event-title">Rocket League Pro Series</h3>
                        <div class="event-meta">
                            <div class="meta-item">
                                <span class="meta-icon">üë§</span>
                                <span>Organisateur: RLChampions</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-icon">üë•</span>
                                <span>Joueurs: 8/10</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-icon">üïê</span>
                                <span>16:00</span>
                            </div>
                        </div>
                        <div class="event-actions">
                            <button class="btn-primary">Rejoindre</button>
                            <button class="btn-secondary">D√©tails</button>
                        </div>
                    </div>

                    <div class="event-card">
                        <div class="event-header">
                            <span class="event-badge upcoming">√Ä VENIR</span>
                            <span class="event-date">28 Nov 2025</span>
                        </div>
                        <div class="event-icon-large">üéØ</div>
                        <h3 class="event-title">Apex Legends Tournament</h3>
                        <div class="event-meta">
                            <div class="meta-item">
                                <span class="meta-icon">üë§</span>
                                <span>Organisateur: ApexPro</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-icon">üë•</span>
                                <span>Joueurs: 15/20</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-icon">üïê</span>
                                <span>15:00</span>
                            </div>
                        </div>
                        <div class="event-actions">
                            <button class="btn-primary">Voir d√©tails</button>
                            <button class="btn-secondary">Se d√©sinscrire</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="activity-section">
            <div class="content-container">
                <h2 class="section-title">Activit√© R√©cente</h2>
                <div class="activity-feed">
                    <div class="activity-item success">
                        <div class="activity-icon">‚úì</div>
                        <div class="activity-content">
                            <div class="activity-title">Inscription valid√©e pour <strong>Tournoi League of Legends</strong></div>
                            <div class="activity-time">Il y a 2 heures</div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">‚≠ê</div>
                        <div class="activity-content">
                            <div class="activity-title">√âv√©nement ajout√© aux favoris</div>
                            <div class="activity-time">Il y a 5 heures</div>
                        </div>
                    </div>

                    <div class="activity-item success">
                        <div class="activity-icon">üèÜ</div>
                        <div class="activity-content">
                            <div class="activity-title">3√®me place au <strong>CS:GO Championship</strong></div>
                            <div class="activity-time">Il y a 2 jours</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="my-events" class="dashboard-section">
        <div class="content-container">
            <h2 class="section-title">Mes √âv√©nements</h2>
            
            <div class="sub-tabs">
                <button class="sub-tab-btn active" data-filter="upcoming">√Ä venir</button>
                <button class="sub-tab-btn" data-filter="past">Pass√©s</button>
                <button class="sub-tab-btn" data-filter="pending">En attente</button>
            </div>

            <div class="events-grid">
                <div class="event-card">
                    <div class="event-header">
                        <span class="event-badge upcoming">√Ä VENIR</span>
                        <span class="event-date">25 Nov 2025</span>
                    </div>
                    <div class="event-icon-large">üéÆ</div>
                    <h3 class="event-title">Tournoi League of Legends</h3>
                    <div class="event-meta">
                        <div class="meta-item">
                            <span class="meta-icon">üë•</span>
                            <span>12/16 joueurs</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-icon">üïê</span>
                            <span>18:00</span>
                        </div>
                    </div>
                    <div class="event-actions">
                        <button class="btn-primary">D√©tails</button>
                        <button class="btn-secondary">Se d√©sinscrire</button>
                    </div>
                </div>

                <div class="empty-state" style="display: none;">
                    <div class="empty-icon">üì≠</div>
                    <p>Aucun √©v√©nement trouv√©</p>
                    <a href="events.html" class="btn-primary">Explorer les √©v√©nements</a>
                </div>
            </div>
        </div>
    </section>

    <section id="favorites" class="dashboard-section">
        <div class="content-container">
            <h2 class="section-title">√âv√©nements Favoris</h2>
            <div class="empty-state">
                <div class="empty-icon">‚≠ê</div>
                <p>Vous n'avez pas encore de favoris</p>
                <a href="events.html" class="btn-primary">Explorer les √©v√©nements</a>
            </div>
        </div>
    </section>

    <section id="scores" class="dashboard-section">
        <div class="content-container">
            <h2 class="section-title">Mes Scores</h2>
            
            <div class="scores-table-wrapper">
                <table class="scores-table">
                    <thead>
                        <tr>
                            <th>√âv√©nement</th>
                            <th>Date</th>
                            <th>Position</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>CS:GO Championship</strong></td>
                            <td>14 Nov 2025</td>
                            <td><span class="position-badge bronze">3√®me</span></td>
                            <td>1,450 pts</td>
                        </tr>
                        <tr>
                            <td><strong>Valorant Cup</strong></td>
                            <td>10 Nov 2025</td>
                            <td><span class="position-badge silver">2√®me</span></td>
                            <td>1,890 pts</td>
                        </tr>
                        <tr>
                            <td><strong>Rocket League Weekly</strong></td>
                            <td>05 Nov 2025</td>
                            <td><span class="position-badge">8√®me</span></td>
                            <td>750 pts</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="profile" class="dashboard-section">
        <div class="content-container">
            <h2 class="section-title">Mon Profil</h2>
            
            <div class="profile-form-container">
                <form class="profile-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" value="progamer@esportify.fr" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstname">Pr√©nom</label>
                            <input type="text" id="firstname" value="Alex" required>
                        </div>
                        <div class="form-group">
                            <label for="lastname">Nom</label>
                            <input type="text" id="lastname" value="Martin" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="game">Jeu favori</label>
                            <select id="game">
                                <option value="lol">League of Legends</option>
                                <option value="valorant">Valorant</option>
                                <option value="csgo">CS:GO</option>
                                <option value="rocket">Rocket League</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary btn-large">
                        üíæ Sauvegarder les modifications
                    </button>
                </form>
            </div>
        </div>
    </section>

    <section id="chat" class="dashboard-section">
        <div class="content-container">
            <h2 class="section-title">üí¨ Chat de l'√âv√©nement</h2>

            <div style="background: rgba(138, 43, 226, 0.1); padding: 1.5rem; border-radius: 15px; margin-bottom: 2rem; border-left: 4px solid #8a2be2;">
                <h4 style="color: #8a2be2; margin-bottom: 1rem;">üìã S√©lectionner un √©v√©nement</h4>
                <select id="event-selector" style="width: 100%; padding: 0.75rem; border-radius: 10px; border: 2px solid #8a2be2; background: rgba(255,255,255,0.1); color: white; font-size: 1rem;">
                    <option value="">-- Choisir un √©v√©nement auquel vous participez --</option>
                    <option value="1">üéÆ Tournoi League of Legends - Finale (25 Nov 2025)</option>
                    <option value="2">üî´ CS:GO Championship (30 Nov 2025)</option>
                    <option value="3">üöó Rocket League Cup (5 D√©c 2025)</option>
                </select>
                <p style="margin-top: 0.75rem; font-size: 0.9rem; color: rgba(255,255,255,0.6);">
                    üí° S√©lectionnez un √©v√©nement pour acc√©der au chat
                </p>
            </div>

            <div id="chat-interface" style="display: none;">
                <div class="messages-wrapper">
                    
                    <div class="messages-header">
                        <div>
                            <h3>
                                üí¨ Discussion
                                <div class="event-name" id="selected-event-name">√âv√©nement</div>
                            </h3>
                        </div>
                        <div class="messages-info">
                            <div class="messages-count">
                                <span class="messages-count-icon">üì®</span>
                                <span class="messages-count-text">
                                    <span id="messages-count">0</span> messages
                                </span>
                            </div>
                            <button class="refresh-btn" onclick="if(messageSystem) messageSystem.loadMessages()" 
                                style="background: rgba(255, 255, 255, 0.1); border: none; padding: 0.5rem 1rem; 
                                border-radius: 20px; color: white; cursor: pointer; transition: all 0.3s;">
                                üîÑ Actualiser
                            </button>
                        </div>
                    </div>

                    <div id="messages-display" class="messages-display">
                        <div class="messages-loading">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>

                    <div class="messages-input-section">
                        <form class="messages-form" onsubmit="event.preventDefault();">
                            <div class="message-input-wrapper">
                                <textarea 
                                    id="message-input" 
                                    class="message-input" 
                                    placeholder="Tapez votre message... (Entr√©e pour envoyer, Shift+Entr√©e pour nouvelle ligne)"
                                    maxlength="500"
                                    rows="1"
                                ></textarea>
                                <div id="char-counter" class="char-counter">0/500</div>
                            </div>
                            <button 
                                type="button" 
                                id="send-message-btn" 
                                class="send-message-btn"
                            >
                                <span class="send-icon">üì§</span>
                                Envoyer
                            </button>
                        </form>
                    </div>
                </div>

                <div style="background: rgba(138, 43, 226, 0.1); border-left: 4px solid #8a2be2; 
                    padding: 1.5rem; border-radius: 10px; margin-top: 2rem;">
                    <h4 style="color: #8a2be2; margin-bottom: 0.5rem;">üí° Conseils d'utilisation</h4>
                    <ul style="list-style: none; padding-left: 0; color: rgba(255, 255, 255, 0.8); font-size: 0.9rem;">
                        <li style="margin-bottom: 0.5rem;">‚úÖ Les messages sont actualis√©s automatiquement toutes les 3 secondes</li>
                        <li style="margin-bottom: 0.5rem;">‚úÖ Appuyez sur Entr√©e pour envoyer rapidement</li>
                        <li style="margin-bottom: 0.5rem;">‚úÖ Utilisez Shift+Entr√©e pour ajouter une nouvelle ligne</li>
                        <li style="margin-bottom: 0.5rem;">‚úÖ Vous pouvez supprimer vos propres messages</li>
                        <li>‚úÖ Maximum 500 caract√®res par message</li>
                    </ul>
                </div>
            </div>

            <div id="chat-placeholder" style="text-align: center; padding: 4rem 2rem; background: rgba(138, 43, 226, 0.05); border-radius: 15px;">
                <div style="font-size: 5rem; margin-bottom: 1rem; opacity: 0.3;">üí¨</div>
                <h3 style="color: #8a2be2; margin-bottom: 1rem;">Aucun √©v√©nement s√©lectionn√©</h3>
                <p style="color: rgba(255, 255, 255, 0.6);">
                    S√©lectionnez un √©v√©nement ci-dessus pour acc√©der au chat et discuter avec les autres participants.
                </p>
            </div>
        </div>
    </section>

    <footer>
        <div class="content-container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="logo">ESPORTIFY</div>
                    <p>La r√©volution e-sport</p>
                </div>
                <div class="footer-links">
                    <h4>Navigation</h4>
                    <ul>
                        <li><a href="../index.html">Accueil</a></li>
                        <li><a href="events.html">√âv√©nements</a></li>
                        <li><a href="../pages/contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-social">
                    <h4>Suivez-nous</h4>
                    <div class="social-links">
                        <a href="#" aria-label="Twitter">üê¶</a>
                        <a href="#" aria-label="Discord">üí¨</a>
                        <a href="#" aria-label="Twitch">üì∫</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Esportify. Tous droits r√©serv√©s.</p>
            </div>
        </div>
    </footer>

    <script src="../js/config.js"></script>
    <script src="../js/dashboard-unified.js"></script>
    <script src="../js/messages.js"></script>
    <script src="../js/global-functions-complete.js"></script>
    <script src="../js/fix-total-final.js"></script>
    
    <script>
        // ===================================================
        // GESTION DU SYST√àME DE MESSAGERIE
        // ===================================================
        
        let currentEventId = null;
        
        // Gestionnaire de s√©lection d'√©v√©nement
        document.getElementById('event-selector').addEventListener('change', function() {
            const eventId = this.value;
            const chatInterface = document.getElementById('chat-interface');
            const chatPlaceholder = document.getElementById('chat-placeholder');
            
            if (eventId) {
                // Afficher l'interface de chat
                chatInterface.style.display = 'block';
                chatPlaceholder.style.display = 'none';
                
                // R√©cup√©rer le nom de l'√©v√©nement
                const selectedOption = this.options[this.selectedIndex];
                const eventName = selectedOption.text;
                document.getElementById('selected-event-name').textContent = eventName;
                
                // Initialiser ou changer le syst√®me de messagerie
                if (messageSystem && currentEventId !== eventId) {
                    messageSystem.destroy();
                }
                
                currentEventId = eventId;
                
                // IMPORTANT: Remplacer par l'ID utilisateur r√©el depuis la session PHP
                // En production: const userId = <?php echo $_SESSION['user_id']; ?>;
                const userId = 1; // ID exemple - √Ä REMPLACER
                
                // Initialiser le syst√®me
                try {
                    initMessageSystem(parseInt(eventId), userId);
                    console.log('‚úÖ Chat initialis√© pour l\'√©v√©nement', eventId);
                } catch (error) {
                    console.error('‚ùå Erreur initialisation chat:', error);
                    alert('Erreur lors du chargement du chat. V√©rifiez que MongoDB est actif.');
                }
            } else {
                // Masquer l'interface
                chatInterface.style.display = 'none';
                chatPlaceholder.style.display = 'block';
                
                // D√©truire le syst√®me de messagerie
                if (messageSystem) {
                    messageSystem.destroy();
                    currentEventId = null;
                }
            }
        });
        
        // Nettoyer lors du changement d'onglet
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const section = this.getAttribute('data-section');
                
                // Si on quitte l'onglet chat, arr√™ter l'auto-refresh
                if (section !== 'chat' && messageSystem) {
                    messageSystem.stopAutoRefresh();
                }
                
                // Si on revient sur l'onglet chat, red√©marrer l'auto-refresh
                if (section === 'chat' && messageSystem && currentEventId) {
                    messageSystem.startAutoRefresh();
                }
            });
        });
        
        // Nettoyer lors du d√©part de la page
        window.addEventListener('beforeunload', function() {
            if (messageSystem) {
                messageSystem.destroy();
            }
        });
    </script>
</body>
</html>
